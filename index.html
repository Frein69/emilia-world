<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Emilia: Magic World</title>
    <style>
        :root { --accent: #ff4081; }
        body { 
            margin: 0; background: #050510; color: white; font-family: 'Segoe UI', sans-serif; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            height: 100vh; overflow: hidden; touch-action: manipulation;
        }
        /* –ñ–∏–≤–æ–π —Ñ–æ–Ω */
        #bg-canvas { position: fixed; inset: 0; z-index: -1; }
        
        .top-bar { position: absolute; top: 20px; width: 90%; display: flex; justify-content: space-between; z-index: 10; }
        .icon { font-size: 30px; cursor: pointer; filter: drop-shadow(0 0 8px var(--accent)); transition: 0.3s; }
        
        #score { font-size: 60px; font-weight: 900; color: var(--accent); text-shadow: 0 0 20px var(--accent); margin: 0; pointer-events: none; }
        
        #hero-container { position: relative; cursor: pointer; }
        #hero-img { height: 50vh; border-radius: 25px; transition: transform 0.1s; z-index: 5; }
        .jump { animation: bounce 0.3s ease; }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(0.92); } }

        /* –≠—Ñ—Ñ–µ–∫—Ç +1 */
        .fly-text {
            position: fixed; color: var(--accent); font-weight: bold; font-size: 24px;
            pointer-events: none; animation: fly 0.8s ease-out forwards; z-index: 100;
        }
        @keyframes fly { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-120px) scale(1.5); } }

        .modal { display: none; position: fixed; background: rgba(0,0,0,0.96); padding: 30px; border-radius: 30px; border: 2px solid var(--accent); z-index: 200; min-width: 280px; }
        .setting { margin: 15px 0; display: flex; flex-direction: column; gap: 8px; }
        button { background: var(--accent); color: white; border: none; padding: 12px; border-radius: 12px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        
        #reg { position: fixed; inset: 0; background: #050510; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        input { padding: 12px; border-radius: 10px; border: 1px solid #333; margin: 10px; width: 220px; background: #111; color: white; }
    </style>
</head>
<body>
    <canvas id="bg-canvas"></canvas>
    <div id="reg">
        <h2 style="color:var(--accent)">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
        <input type="text" id="n-in" placeholder="–ù–∏–∫–Ω–µ–π–º" maxlength="17">
        <button onclick="saveAcc()">–ù–∞—á–∞—Ç—å –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ</button>
    </div>

    <div class="top-bar">
        <div class="icon" onclick="openM('sett')">‚öôÔ∏è</div>
        <div class="icon" onclick="openM('chars')">üë•</div>
    </div>

    <div style="text-align: center;">
        <p id="user-info" style="opacity:0.6"></p>
        <h1 id="score">0</h1>
    </div>

    <div id="hero-container" onclick="clickHero(event)">
        <img id="hero-img" src="https://i.pinimg.com/736x/c1/9d/9b/c19d9b04f7678122a27b8787f7b578c9.jpg">
    </div>

    <div class="modal" id="sett">
        <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
        <div class="setting">
            <label>–¶–≤–µ—Ç –¢–µ–∫—Å—Ç–∞/–ù–µ–æ–Ω–∞:</label>
            <select onchange="changeColor(this.value)">
                <option value="#ff4081">–†–æ–∑–æ–≤—ã–π –ù–µ–æ–Ω</option>
                <option value="#ffffff">–ë–µ–ª—ã–π –ñ–µ–º—á—É–≥</option>
                <option value="#00f2fe">–ì–æ–ª—É–±–æ–π –õ–µ–¥</option>
                <option value="#ff8c00">–û—Ä–∞–Ω–∂–µ–≤—ã–π –ó–∞–∫–∞—Ç</option>
                <option value="#7fff00">–ó–µ–ª–µ–Ω—ã–π –õ–∞–π–º</option>
                <option value="#9370db">–§–∏–æ–ª–µ—Ç–æ–≤—ã–π –ú–∞–≥</option>
            </select>
        </div>
        <button onclick="closeM()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <div class="modal" id="chars"><h3>–ü–µ—Ä—Å–æ–Ω–∞–∂–∏</h3><p>üîí –°–∫–æ—Ä–æ...</p><button onclick="closeM()">–ù–∞–∑–∞–¥</button></div>

    <script>
        let state = JSON.parse(localStorage.getItem('em_world_v4')) || { s: 0, n: '', c: '#ff4081' };
        let isPressed = false;

        // –†–∏—Å—É–µ–º —Ñ–æ–Ω (–∑–≤–µ–∑–¥—ã)
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        let stars = [];
        function initStars() {
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            stars = [];
            for(let i=0; i<100; i++) stars.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height, r: Math.random()*2, v: Math.random()*0.5});
        }
        function drawStars() {
            ctx.clearRect(0,0,canvas.width, canvas.height);
            ctx.fillStyle = "white";
            stars.forEach(s => {
                ctx.beginPath(); ctx.arc(s.x, s.y, s.r, 0, Math.PI*2); ctx.fill();
                s.y += s.v; if(s.y > canvas.height) s.y = 0;
            });
            requestAnimationFrame(drawStars);
        }
        initStars(); drawStars();

        function saveAcc() { state.n = document.getElementById('n-in').value || 'NoName'; init(); }
        function init() { 
            if(state.n) document.getElementById('reg').style.display = 'none';
            document.getElementById('user-info').innerText = `–ò–≥—Ä–æ–∫: ${state.n}`;
            changeColor(state.c); updateUI();
        }

        function clickHero(e) {
            state.s++;
            const img = document.getElementById('hero-img');
            img.classList.remove('jump'); void img.offsetWidth; img.classList.add('jump');
            
            // –≠—Ñ—Ñ–µ–∫—Ç +1
            const ft = document.createElement('div');
            ft.className = 'fly-text'; ft.innerText = '+1';
            ft.style.left = (e ? e.clientX : window.innerWidth/2) + 'px';
            ft.style.top = (e ? e.clientY : window.innerHeight/2) + 'px';
            document.body.appendChild(ft);
            setTimeout(() => ft.remove(), 800);

            updateUI();
        }

        // –ö–õ–ê–í–ò–ê–¢–£–†–ê: –ü—Ä–æ–±–µ–ª –∏ Enter
        window.onkeydown = (e) => {
            if((e.code === 'Space' || e.code === 'Enter') && !isPressed) {
                isPressed = true; clickHero();
            }
        };
        window.onkeyup = (e) => { if(e.code === 'Space' || e.code === 'Enter') isPressed = false; };

        function openM(id) { document.getElementById(id).style.display = 'block'; }
        function closeM() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }
        function changeColor(c) { state.c = c; document.documentElement.style.setProperty('--accent', c); }
        function updateUI() { document.getElementById('score').innerText = state.s; localStorage.setItem('em_world_v4', JSON.stringify(state)); }
        
        init();
    </script>
</body>
</html>
